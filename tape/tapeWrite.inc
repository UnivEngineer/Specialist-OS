;+---------------------------------------------------------------------------
; MXOS
; Запись байта на ленту
;
; На входе 
;   a - байт
;
; На выходе
;   все регистры сохраняются
;
; 2013-12-12 Дизассемблировано vinxru
;----------------------------------------------------------------------------

tapeWrite:  ; Сохранение регистров
            push  bc
            push  de
            push  af

            ld    d, a

            ; Надо записть 8 бит
            ld    c, 8        

tapeWrite_1:
            ; Сдвинуть d
            ld    a, d
            rlca
            ld    d, a

            ; Вывести бит на ленту
            and   1
            or    0Eh
            ld    (IO_KEYB_MODE),a
            ld    e, a

            ; Задержка
            call  writeDelay

            ; Вывести инверсный бит на магнитофон
            ld    a, e
            xor   1
            ld    (IO_KEYB_MODE),a

            ; Задержка
            call  writeDelay

            ; Повторить 8 раз
            dec   c
            jp nz,  tapeWrite_1

            ; Восстановление регистров и выход
            pop   af
            pop   de
            pop   bc
            ret

