0001   0000             ;+---------------------------------------------------------------------------
0002   0000             ; MXOS
0003   0000             ; FLPAGE.COM - переключатель страниц флеш-диска ВВ55
0004   0000             ;
0005   0000             ; 2022-01-25 Разработано SpaceEngineer
0006   0000             ;
0007   0000             ;----------------------------------------------------------------------------
0008   0000             
0009   0000             ; Функции системы
0010   0000             printChar       = 0C809h ; Вывод символа на экран
0011   0000             input           = 0C80Fh ; Ввод строки с клавиатуры
0012   0000             printHexByte	= 0C815h ; Вывести 16-ричное число (байт)
0013   0000             printString     = 0C818h ; Вывести строку на экран
0014   0000             strToHex        = 0C839h ; Преобразвоние строки в HEX формате в число
0015   0000             
0016   0000             ; Переменные системы
0017   0000             v_flashPage     = 8FF9h  ; Текущая страница флеш-диска (макс. 1Fh = 31)
0018   0000             v_input         = 0DE8Eh ; Буфер для ввода строки
0019   0000             
0020   8000             .org 08000H
0021   8000             
0022   8000                     ; вывод текущей страницы
0023   8000 21 36 80    	    lxi  h, txtCurrentPage
0024   8003 CD 18 C8    	    call printString
0025   8006 3A F9 8F            lda  v_flashPage
0026   8009 CD 15 C8            call printHexByte
0027   800C             
0028   800C             Repeat:
0029   800C                     ; вывод запроса
0030   800C 21 4D 80    	    lxi  h, txtEnterPage
0031   800F CD 18 C8    	    call printString
0032   8012             
0033   8012                     ; ввод строки
0034   8012 21 8E DE    	    lxi  h, v_input
0035   8015 11 A5 DE    	    lxi  d, v_input+23
0036   8018 CD 0F C8            call input
0037   801B             
0038   801B                     ; анализ строки
0039   801B EB                  xchg
0040   801C CD 39 C8            call strToHex
0041   801F CA 0C 80            jz   Repeat
0042   8022             
0043   8022                     ; проверяем значение
0044   8022 11 20 00            lxi  d, 20h ; макс. 1Fh + 1
0045   8025 CD 30 80            call cmp_hl_de
0046   8028 D2 0C 80            jnc  Repeat
0047   802B             
0048   802B                     ; записываем результат
0049   802B 7D                  mov a, l
0050   802C 32 F9 8F            sta v_flashPage
0051   802F C9                  ret
0052   8030             
0053   8030             cmp_hl_de:
0054   8030 7C                  mov	a, h
0055   8031 BA                  cmp	d
0056   8032 C0                  rnz
0057   8033 7D                  mov	a, l
0058   8034 BB                  cmp	e
0059   8035 C9                  ret
0060   8036             
0061   8036             txtCurrentPage:
0062   8036 0A 43 55 52         .db 0Ah,"CURRENT PAGE NUMBER: ",0
0062   803A 52 45 4E 54 
0062   803E 20 50 41 47 
0062   8042 45 20 4E 55 
0062   8046 4D 42 45 52 
0062   804A 3A 20 00 
0063   804D             
0064   804D             txtEnterPage:
0065   804D 0A 45 4E 54         .db 0Ah,"ENTER NEW PAGE NUMBER (0-1F): ",0
0065   8051 45 52 20 4E 
0065   8055 45 57 20 50 
0065   8059 41 47 45 20 
0065   805D 4E 55 4D 42 
0065   8061 45 52 20 28 
0065   8065 30 2D 31 46 
0065   8069 29 3A 20 00 
0066   806D             
0067   806D             .END
tasm: Number of errors = 0
