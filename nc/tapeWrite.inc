;----------------------------------------------------------------------------
; MXOS NC.COM
; Запись слова на ленту
;
; 2013-12-18 Дизассемблировано vinxru
;----------------------------------------------------------------------------

tapeWriteWord:
            ld    a, l
            call  bios_tapeWrite
            ld    a, h
            jp    bios_tapeWrite

;----------------------------------------------------------------------------
; Запись блока данных по адресу hl длиной bc+1 на ленту
;----------------------------------------------------------------------------

tapeWriteBlock:
            inc    bc
loc_D410:   call   checkBreak
            ld     a, (hl)
            call   bios_tapeWrite
            inc    hl
            dec    bc
            ld     a, b
            or     c
            jp nz, loc_D410
            ret

;----------------------------------------------------------------------------
; Запись пилот тона на ленту
; 200h нулей, затем E6h
;----------------------------------------------------------------------------

tapeWritePilot:
            ld     bc, 200h
loc_D422:   call   checkBreak
            xor    a
            call   bios_tapeWrite
            dec    bc
            ld     a, b
            or     c
            jp nz, loc_D422

            ld    a, 0E6h
            jp    bios_tapeWrite

; ---------------------------------------------------------------------------

checkBreak: ld     a, (IO_KEYB_B)
            and    a
            jp p,  tapeErrorHandler
            ret

