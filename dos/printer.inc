;+---------------------------------------------------------------------------
; MXOS
; Вывод байта на принтер
;
; На входе 
;   c - байт
;
; На выходе 
;   af, bc, de, hl - cохраняются
;
; 2013-12-12 Дизассемблировано vinxru
;----------------------------------------------------------------------------

printer:    ; Сохраняем регистры
            push  af

            ; Режим порта расширения
            ld    a, 90h
            ld    (IO_PROG_MODE), a

            ; Выводим байт на принтер
            ld    a, c        
            CPL
            ld    (IO_PROG_B), a

printer_loop:     ; Выход     при нажатии любой клавиши
            ld    a, (IO_KEYB_B)     
            and   2
            jp z, printer_ret

            ; Ждем пока принтер не будет готов
            ld    a, (IO_PROG_A)       
            and   40h
            jp nz,  printer_loop
            
            ; Строб
            ld    a, 3        
            ld    (IO_PROG_C), a
            xor   a
            ld    (IO_PROG_C), a

printer_ret:      ; Восстаналвиаем регистры
            pop   af
            ret

