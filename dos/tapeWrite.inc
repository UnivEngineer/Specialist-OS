;+---------------------------------------------------------------------------
; MXOS
; Запись байта на ленту
;
; На входе 
;   a - байт
;
; На выходе
;   все регистры сохраняются
;
; 2013-12-12 Дизассемблировано vinxru
;----------------------------------------------------------------------------

tapeWrite:	; Сохранение регистров
		push	b
		push	d
		push	psw

		mov	d, a

		; Надо записть 8 бит
		mvi	c, 8		

tapeWrite_1:	; Сдвинуть D
		mov	a, d
		rlc
		mov	d, a

		; Вывести бит на ленту
		ani	1
		ori	0Eh
		sta	IO_KEYB_MODE
		mov	e, a

		; Задержка
		call	writeDelay

		; Вывести инверсный бит на магнитофон
		mov	a, e
		xri	1
		sta	IO_KEYB_MODE

		; Задержка
		call	writeDelay

		; Повторить 8 раз
		dcr	c
		jnz	tapeWrite_1

		; Восстановление регистров и выход
		pop	psw
		pop	d
		pop	b
		ret

